<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="How to Run a Rust Server in Docker on AWS" /><meta name="author" content="Hieu Huynh" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/" /><meta property="og:url" content="https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/" /><meta property="og:site_name" content="What a Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-21T12:10:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to Run a Rust Server in Docker on AWS" /><meta name="twitter:site" content="@hubris_maximus" /><meta name="twitter:creator" content="@Hieu Huynh" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Hieu Huynh"},"dateModified":"2024-10-11T19:07:40-07:00","datePublished":"2022-03-21T12:10:00-07:00","description":"Introduction","headline":"How to Run a Rust Server in Docker on AWS","mainEntityOfPage":{"@type":"WebPage","@id":"https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/"},"url":"https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/"}</script><title>How to Run a Rust Server in Docker on AWS | What a Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="What a Blog"><meta name="application-name" content="What a Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://i.imgur.com/Hqf9WbC.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">What a Blog</a></div><div class="site-subtitle font-italic">Instructional guides and miscellaneous life stuff.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/hhuynh15" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/hubris_maximus" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['hieu','hieuhuynh.net'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to Run a Rust Server in Docker on AWS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 767 384'%3E%3C/svg%3E" data-src="https://i.imgur.com/rOSM02X.png" class="preview-img bg" alt="Preview Image" width="767" height="384" data-proofer-ignore><h1 data-toc-skip>How to Run a Rust Server in Docker on AWS</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/hhuynh15">Hieu Huynh</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1647889800" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-03-21 </em> </span> <span> Updated <em class="timeago" data-ts="1728698860" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2024-10-11 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1787 words"> <em>9 min</em> read</span></div></div></div><div class="post-content"><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>This guide will teach you how to run your own Rust server on the cloud. This guide assumes you already have some Linux knowledge and that you will be able to manage your server on your own after everything is set up. This is made for people who are not familiar with Docker or cloud services. Although we will be using AWS for this guide, the instructions here can be applied to any cloud service provider or even on your own dedicated server.</p><h2 id="whats-docker-and-why-docker"><span class="mr-2">What’s Docker and why Docker?</span><a href="#whats-docker-and-why-docker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Docker is a system for running services such as apps in a containerized setting. This will give you the freedom to control the resources used by your servers and will also make it easier for you to expand to multiple servers in the future if you so wish. It will also allow you to freely move your server between devices and restore from backups. If you wish to learn more about Docker and how it works, you can read more from <a href="https://www.docker.com/resources/what-container/">here</a>.</p><h2 id="pre-setup"><span class="mr-2">Pre-setup</span><a href="#pre-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>The only thing you will need is an AWS account. If you don’t have one yet, you can make one <a href="https://signin.aws.amazon.com/signin?redirect_uri=https%3A%2F%2Fportal.aws.amazon.com%2Fbilling%2Fsignup%2Fresume&amp;client_id=signup&amp;code_challenge_method=SHA-256&amp;code_challenge=QJtklNBj78wdUxQgKDGEbr12Unt45QcxmWE-rLR_Rcs">here</a>.</p><h2 id="launching-a-cloud-instance"><span class="mr-2">Launching a Cloud Instance</span><a href="#launching-a-cloud-instance" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><ol><li>Once logged into your AWS account, you can use the search bar at the top of the page and search for “EC2”.<li>Select the first option and it will take you to the EC2 page.<li>Click the large orange button that says “Launch instances” on the top right.<li>Scroll down until you see “Ubuntu Server 18.04 LTS (HVM), SSD Volume Type” and select it.<li>When selecting which CPU type it’s important to select one that can accommodate the size of your server.<li>Since this is for demonstration purposes I will be selecting the “r5a large” type which can handle about 16 players.<li>After selecting your CPU and memory hit next on the bottom right until you reach the “Add Storage” page.<li>Here you change the size of your instance to 30 GiB.<li>Now you can hit “Review and Launch” and then launch your new instance.<li>A screen will pop up asking you if you want to “Select an existing key pair or create a new key pair”.<li>Since this is our first time launching an instance, select “Create a new key pair”.<li>Set whatever name you want for the key pair name.<li>Press “Download Key Pair” and it will go to your downloads folder.<li>You might have to wait several minutes before your instance is launched and is accessible.</ol><h2 id="installing-docker-and-launching-your-rust-server"><span class="mr-2">Installing Docker and Launching Your Rust Server</span><a href="#installing-docker-and-launching-your-rust-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>In order to access your new instance you will need to use the key pair you created and downloaded earlier. The permissions of the private key will need to be modified so that you can use it. If you are on Linux, simply navigate to the folder where your key file is located and type the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">chmod </span>400 <span class="o">{</span>Private key name<span class="o">}</span>.pem
</pre></table></code></div></div><p>On Windows you will have to modify the permissions of the file by right clicking the file then selecting properties and under the security tab hit “Advanced”. On the new window that pops up you must remove permissions from “Users”. This is how it looks on my desktop:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 586 114'%3E%3C/svg%3E" data-src="https://i.imgur.com/hv0ncC1.png" alt="Advanced Window" width="586" height="114" data-proofer-ignore></p><p>Select “Users” and hit “Remove” then go back to your AWS instances page and look for your “Public IPv4 DNS”. It will look something like this:</p><p><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1715 70'%3E%3C/svg%3E" data-src="https://i.imgur.com/2O9Zc8O.png" alt="IPv4 Public DNS" width="1715" height="70" data-proofer-ignore></p><p>You will need the “Public IPv4 DNS” to connect to your instance. Once completed you can open your terminal or command prompt and navigate to the folder with your private key. Enter the following command to connect to your instance:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ssh <span class="nt">-i</span> <span class="o">{</span>Private key name<span class="o">}</span>.pem ubuntu@<span class="o">{</span>Public IPv4 DNS<span class="o">}</span>
</pre></table></code></div></div><p>If everything is successful you should be greeted with a “Welcome to Ubuntu 18.04.6 LTS” message in your terminal. And the first thing we will be doing is running the two following commands:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>apt update
apt upgrade
</pre></table></code></div></div><p>This will update and upgrade our repositories and repository libraries. Next we will install Docker:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>apt <span class="nb">install </span>docker.io
</pre></table></code></div></div><p>Let’s launch our Rust server for the first time!</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">--name</span> rust-server didstopia/rust-server
</pre></table></code></div></div><p>What this does is, first download the latest rust-server image from Docker Hub (a public repository of Docker images), then it starts a new rust-server container, giving it the name “rust-server”. This might take a while as you are starting your server for the first time. To stop your server you can use:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker stop rust-server
</pre></table></code></div></div><p>To see a full list of Docker commands you can use:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">help</span>
</pre></table></code></div></div><h2 id="configuring-your-rust-server"><span class="mr-2">Configuring your Rust Server</span><a href="#configuring-your-rust-server" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>First create your server configuration file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">touch</span> /rust.env
</pre></table></code></div></div><p>Inside the file you will need to add your environment variables. Put the following and customize where necessary:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>RUST_SERVER_STARTUP_ARGUMENTS=-batchmode -load +server.secure 1
RUST_SERVER_IDENTITY=rustserver
RUST_SERVER_SEED=12345
RUST_SERVER_NAME=My Containerized Rust Server on AWS!
RUST_SERVER_DESCRIPTION=I made this!
RUST_RCON_PASSWORD=CHANGEME
</pre></table></code></div></div><p>There are a lot more variables you can use to customize your servers. A full list can be found <a href="https://hub.docker.com/r/didstopia/rust-server/">here</a>. Before firing up your Rust server with your new environment variables file you must delete your old container:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">rm </span>rust-server
</pre></table></code></div></div><p>Next, run the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run <span class="nt">--name</span> rust-server <span class="nt">-d</span> <span class="nt">-p</span> 28015:28015 <span class="nt">-p</span> 28015:28015/udp <span class="nt">-p</span> 28016:28016 <span class="nt">-p</span> 8080:8080 <span class="nt">-v</span> /rust:/steamcmd/rust <span class="nt">--env-file</span> /rust.env didstopia/rust-server
</pre></table></code></div></div><p>We have added the <code class="language-plaintext highlighter-rouge">-d</code> flag, which will detach or daemonize the process, so that we won’t get regular console outputs from the server anymore.</p><p>The <code class="language-plaintext highlighter-rouge">-p</code> flag will bind our local ports to the container ports, which will enable us to connect to the server from outside our network.</p><p>The <code class="language-plaintext highlighter-rouge">-v</code> flag is where the magic happens, as the <code class="language-plaintext highlighter-rouge">-v</code> flag translates to volume. Meaning it will mount a volume on the local filesystem inside the container. The first part is the host path (<code class="language-plaintext highlighter-rouge">/rust</code> in this case), and the second part is the container path (<code class="language-plaintext highlighter-rouge">/steamcmd/rust</code>, which is always the same).</p><p>Since Docker containers aren’t persistent (they can’t be permanently modified, changes aren’t saved and so on), using a volume will now store both the Rust installation data, as well as the server data (level, users, blueprints, logfiles). Storing the Rust installation data on the host system means that when the container is restarted, it won’t have to download the entire server again, but it can still update it if necessary.</p><p>The <code class="language-plaintext highlighter-rouge">--env-file</code> flag simply loads our variables from the file we set up earlier.</p><p>You should now have a full functioning, fully configured server setup. All that’s left now is to make sure it automatically restarts in case it crashes, or the host system is restarted.</p><h2 id="automatic-startup"><span class="mr-2">Automatic Startup</span><a href="#automatic-startup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>Create a new file in <code class="language-plaintext highlighter-rouge">/usr/local/sbin/docker_startup.service</code> and paste the following in it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="c">#deletes image</span>
/usr/bin/docker <span class="nb">rm</span> <span class="nt">-f</span> rust-server 2&gt;/dev/null <span class="o">||</span> <span class="nb">true</span>

<span class="c">#pulls and runs a new Rust server</span>
/usr/bin/docker run <span class="nt">--name</span> rust-server <span class="nt">-d</span> <span class="nt">--restart</span> unless-stopped <span class="nt">-p</span> 28015:28015 <span class="nt">-p</span> 28015:28015/udp <span class="nt">-p</span> 28016:28016 <span class="nt">-p</span> 28082:28082 <span class="nt">-v</span> /rust:/steamcmd/rust <span class="nt">--env-file</span> /rust.env <span class="nt">-m</span> 16g <span class="nt">--cpus</span><span class="o">=</span><span class="s2">"2"</span> didstopia/rust-server
</pre></table></code></div></div><p>Note that this particular startup script uses the <code class="language-plaintext highlighter-rouge">--rm</code> flag, which will destroy the container once it’s stopped. This allows for clean starting/stopping of the server, as the container name will always be available this way. We’re also forcibly destroying the container both when stopping and starting the server, just in case anything goes wrong.</p><p>Create another file in <code class="language-plaintext highlighter-rouge">/etc/systemd/system/startup.service</code> and paste the following in it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="o">[</span>Unit]
<span class="nv">Description</span><span class="o">=</span>Startup Services
<span class="nv">After</span><span class="o">=</span>multi-user.target
<span class="nv">After</span><span class="o">=</span>network-online.target
<span class="nv">Wants</span><span class="o">=</span>network-online.target

<span class="o">[</span>Service]
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/sbin/docker_startup.service
<span class="nv">User</span><span class="o">=</span>root
<span class="nv">Group</span><span class="o">=</span>root

<span class="o">[</span>Install]
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre></table></code></div></div><p>This will create the service and will allow you stop start and stop the startup service with the following commands:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>service rust-server start
service rust-server stop
service rust-server status
</pre></table></code></div></div><h2 id="controlling-resources"><span class="mr-2">Controlling Resources</span><a href="#controlling-resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>It’s important to control how much resource your server uses as one process overconsuming resources can end up causing other programs to crash when they hit their limit. And Rust is known to be a very resource-heavy application. Another thing is that Rust (or more accurately Unity) is known to crash when using more than 16GB of memory. Docker can solve this issue easily by adding the following flag to your <code class="language-plaintext highlighter-rouge">docker run</code> command: <code class="language-plaintext highlighter-rouge">-m 16g</code>. This will limit the maximum amount of memory your container can consume to 16GB.</p><p>To limit your CPU utilization you can add the <code class="language-plaintext highlighter-rouge">--cpus="2.0"</code> flag when running your container. The <code class="language-plaintext highlighter-rouge">"2.0"</code> in the flag represents the amount of CPUs you are allotting to that container. You can also use decimal values like <code class="language-plaintext highlighter-rouge">--cpus="0.5"</code> or <code class="language-plaintext highlighter-rouge">--cpus="1.5"</code>.</p><p>Remember to add all Docker arguments before the image name (in this case <code class="language-plaintext highlighter-rouge">didstopia/rust-server</code>) otherwise they’ll get ignored.</p><h2 id="using-custom-maps"><span class="mr-2">Using Custom Maps</span><a href="#using-custom-maps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>If you wish to use a custom map for your server it is quite simple to do so. The only difference between the standard way of using a custom map and using one for your containerized Rust server, is that instead of editing your <code class="language-plaintext highlighter-rouge">server.cfg</code> file you will be editing your environment variables file instead. First, you will need to open your environment file, in this case <code class="language-plaintext highlighter-rouge">rust.env</code> and remove or comment out the <code class="language-plaintext highlighter-rouge">RUST_SERVER_SEED=</code> argument and the <code class="language-plaintext highlighter-rouge">RUST_SERVER_WORLDSIZE=</code> argument. Next, you will need to follow this <a href="https://shockbyte.com/billing/knowledgebase/190/How-to-Add-a-Custom-Map-to-Your-Rust-Server.html">guide</a> to install the necessary dependencies and then to also obtain a direct download URL. In your environment variables file under <code class="language-plaintext highlighter-rouge">RUST_SERVER_STARTUP_ARGUMENTS=</code> add the following starting parameter: <code class="language-plaintext highlighter-rouge">-levelurl "{direct download link for your custom map}"</code>. For example, this is how my file looks:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="nv">RUST_SERVER_STARTUP_ARGUMENTS</span><span class="o">=</span><span class="nt">-batchmode</span> <span class="nt">-load</span> +server.secure 1 <span class="nt">-levelurl</span> <span class="s2">"https://www.dropbox.com/s/cgbu3o0tngp9qgt/RedSandsCustom.map?dl=1"</span>
<span class="nv">RUST_SERVER_IDENTITY</span><span class="o">=</span>rustserver
<span class="c">#RUST_SERVER_SEED=12345</span>
<span class="nv">RUST_SERVER_NAME</span><span class="o">=</span>My Containerized Rust Server on AWS!
<span class="nv">RUST_SERVER_DESCRIPTION</span><span class="o">=</span>I made this!
<span class="nv">RUST_RCON_PASSWORD</span><span class="o">=</span>CHANGEME
</pre></table></code></div></div><h2 id="useful-commands"><span class="mr-2">Useful Commands</span><a href="#useful-commands" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>To access the server console, we can do so with this command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker logs <span class="nt">-f</span> rust-server
</pre></table></code></div></div><p>To stop the server, we would run:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker stop rust-server
</pre></table></code></div></div><p>To update to the latest image by pulling from Docker Hub:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker pull didstopia/rust-server
</pre></table></code></div></div><p>If you get an error saying that a server with the name <em>rust-server</em> already exists, we can remove the container by running:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">rm</span> <span class="nt">-f</span> rust-server
</pre></table></code></div></div><p>To send an RCON command to your server, you can use the following:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker <span class="nb">exec </span>rust-server rcon <span class="o">{</span><span class="nb">command</span><span class="o">}</span>
</pre></table></code></div></div><p>To monitor your resource usage for each container:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker stats
</pre></table></code></div></div><p>To change an existing container’s environment variables you will have to edit the following file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>vim /var/lib/docker/containers/<span class="o">{</span>container-id<span class="o">}</span>/config.json
</pre></table></code></div></div><p>You can find the container-id by executing the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker inspect <span class="o">[</span>container-name] | <span class="nb">grep</span> <span class="s2">"Id"</span>
</pre></table></code></div></div><h2 id="final-notes"><span class="mr-2">Final Notes</span><a href="#final-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><hr /><p>I am still learning the Linux ecosystem and Docker so I will continually update this guide as I find better ways to launch and manage applications. If you find anything I’ve said here to be erroneous or if there is a better way to do things, feel free to contact me and let me know! I would love to hear any type of feedback.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/guides/'>Guides</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/instructional/" class="post-tag no-text-decoration" >Instructional</a> <a href="/tags/guides/" class="post-tag no-text-decoration" >Guides</a> <a href="/tags/cloud/" class="post-tag no-text-decoration" >Cloud</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >AWS</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >Linux</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >Docker</a> <a href="/tags/rust/" class="post-tag no-text-decoration" >Rust</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to Run a Rust Server in Docker on AWS - What a Blog&amp;url=https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to Run a Rust Server in Docker on AWS - What a Blog&amp;u=https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://hhuynh15.github.io//posts/rust-server-in-docker-on-aws/&amp;text=How to Run a Rust Server in Docker on AWS - What a Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/bash-scripting/">How I Only Spend 30 Minutes a Month to Run My Rust Server</a><li><a href="/posts/lets-build-a-home-server-rack/">Let's Build a Home Server Rack</a><li><a href="/posts/wifi-brute-forcing-with-hashcat/">How to Perform a Brute Force Attack on a WiFi Network</a><li><a href="/posts/tech-layoffs-and-you/">Tech Layoffs and You</a><li><a href="/posts/rust-server-in-docker-on-aws/">How to Run a Rust Server in Docker on AWS</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/guides/">Guides</a> <a class="post-tag" href="/tags/instructional/">Instructional</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/networking/">Networking</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/blogging/">Blogging</a> <a class="post-tag" href="/tags/career/">Career</a> <a class="post-tag" href="/tags/news/">News</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/tech/">Tech</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/lets-build-a-home-server-rack/"><div class="card-body"> <em class="timeago small" data-ts="1667647260" > 2022-11-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Let's Build a Home Server Rack</h3><div class="text-muted small"><p> Introduction Building a home server rack is a great way to expand your knowledge in network and server administration, and gain hands-on experience with enterprise-level technologies. By using Li...</p></div></div></a></div><div class="card"> <a href="/posts/bash-scripting/"><div class="card-body"> <em class="timeago small" data-ts="1728662400" > 2024-10-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I Only Spend 30 Minutes a Month to Run My Rust Server</h3><div class="text-muted small"><p> Introduction Running a Rust game server can be a complex and time consuming, but with the power of Bash scripting and Linux scheduling tools like Cron and At, we can automate many aspects of serv...</p></div></div></a></div><div class="card"> <a href="/posts/wifi-brute-forcing-with-hashcat/"><div class="card-body"> <em class="timeago small" data-ts="1657020060" > 2022-07-05 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Perform a Brute Force Attack on a WiFi Network</h3><div class="text-muted small"><p> Introduction This guide will teach you some basic penetration testing skills for wireless networks. I hope to also demonstrate how having a weak password can leave even the most secure networks v...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="/posts/wifi-brute-forcing-with-hashcat/" class="btn btn-outline-primary" prompt="Newer"><p>How to Perform a Brute Force Attack on a WiFi Network</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/hubris_maximus">Hieu Huynh</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/guides/">Guides</a> <a class="post-tag" href="/tags/instructional/">Instructional</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/networking/">Networking</a> <a class="post-tag" href="/tags/automation/">Automation</a> <a class="post-tag" href="/tags/blogging/">Blogging</a> <a class="post-tag" href="/tags/career/">Career</a> <a class="post-tag" href="/tags/news/">News</a> <a class="post-tag" href="/tags/rust/">Rust</a> <a class="post-tag" href="/tags/tech/">Tech</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
